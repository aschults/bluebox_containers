{
   "kind":"Deployment",
   "apiVersion":"extensions/v1beta1",
   "metadata":{
      "name":"mosquitto"
   },
   "spec":{
      "replicas":1,
      "template":{
         "metadata":{
            "labels":{
               "app":"mqtt",
               "pkg":"mosquitto"
            }
         },
         "spec":{
            "containers":[
               {
                  "name":"mosquitto",
                  "image":"eclipse-mosquitto",
                  "imagePullPolicy":"Always",
                  "ports":[
                     {
                        "name":"mqtt",
                        "containerPort":1883
                     }
                  ],
                  "volumeMounts": [
                     {
                        "mountPath":"/mosquitto/config",
                        "name":"mosquitto-config"
                     },
                     {
                        "mountPath":"/mosquitto/data",
                        "name":"mosquitto-data"
                     }
                  ],
                  "livenessProbe": {
                     "exec": {
                        "command": [
                           "/bin/sh",	
                           "/mosquitto/config/liveness.sh"
                        ]
                     },
                     "initialDelaySeconds": 30,
                     "timeoutSeconds": 2
                  } 
               }
            ],
            "volumes":[
               {
                 "name":"mosquitto-data",
                 "persistentVolumeClaim": {
                    "claimName":"mosquitto-data-disk-claim"
                 }
               },
               {
                 "name":"mosquitto-config",
                 "persistentVolumeClaim": {
                    "claimName":"mosquitto-conf-disk-claim"
                 }
               }
            ]
         }
      }
   }
}
