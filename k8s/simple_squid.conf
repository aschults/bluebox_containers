{
   "kind":"PersistentVolume",
   "apiVersion":"v1",
   "metadata":{
      "name":"squid-cache-disk",
      "labels":{
         "app":"web-proxy",
         "pkg":"squid"
      }
   },
   "spec":{
      "capacity":{
         "storage":"500Mi"
      },
      "accessModes":["ReadWriteMany"],
      "hostPath":{
         "path":"/var/tmp/squiddisk"
      }
   }
}
{
   "kind":"PersistentVolumeClaim",
   "apiVersion":"v1",
   "metadata":{
      "name":"squid-disk-claim",
      "labels":{
         "pkg":"squid"
      }
   },
   "spec": {
      "resources":{
         "requests": {
            "storage":"500Mi"
         }
      },
      "accessModes":["ReadWriteMany"],
      "volumeName":"squid-cache-disk"
   }
}
{
   "kind":"ReplicationController",
   "apiVersion":"v1",
   "metadata":{
      "name":"simple-squid",
      "labels":{
         "app":"web-proxy",
         "pkg":"squid"
      }
   },
   "spec":{
      "replicas":3,
      "selector":{
         "app":"web-proxy",
         "pkg":"squid"
      },
      "template":{
         "metadata":{
            "labels":{
               "app":"web-proxy",
               "pkg":"squid"
            }
         },
         "spec":{
            "containers":[
               {
                  "name":"squid",
                  "image":"aschults/bluebox_squid",
                  "imagePullPolicy":"Always",
                  "env":[
                     {
                         "name":"cache_size",
                         "value":"500"
                     },
                     {
                         "name":"xxx_allowed_source_networks",
                         "value":"192.168.0.0/16"
                     }
                  ],
                  "ports":[
                     {
                        "name":"proxy",
                        "containerPort":3128
                     }
                  ],
                  "volumeMounts": [
                     {
                        "mountPath":"/var/spool/squid/cache",
                        "name":"sqdisk"
                     }
                  ]
               }
            ],
            "volumes":[
               {
                 "name":"sqdisk",
                 "persistentVolumeClaim": {
                    "claimName":"squid-disk-claim"
                 }
               }
            ]
         }
      }
   }
}
{
   "kind":"Service",
   "apiVersion":"v1",
   "metadata":{
      "name":"web-proxy",
      "labels":{
         "app":"web-proxy"
      }
   },
   "spec":{
      "ports": [
         {
           "port":3128,
           "targetPort":"proxy"
         }
      ],
      "selector":{
         "app":"web-proxy"
      },
      "type": "LoadBalancer",
      "externalIPs" : [
          "192.168.2.131"
      ]

   }
}
