{
   "kind":"Deployment",
   "apiVersion":"extensions/v1beta1",
   "metadata":{
      "name":"simple-squid"
   },
   "spec":{
      "replicas":2,
      "template":{
         "metadata":{
            "labels":{
               "app":"web-proxy",
               "pkg":"squid"
            }
         },
         "spec":{
            "containers":[
               {
                  "name":"squid",
                  "image":"aschults/bluebox_squid:filtering_squid_latest",
                  "imagePullPolicy":"Always",
                  "env":[
                     {
                         "name":"proxy_auth",
                         "valueFrom": {
                           "configMapKeyRef": {
                             "name": "squidconfig",
                             "key": "squid.passwd"
                           }
                         }
                     },
                     {
                         "name":"secondary_port",
                         "value":"1"
                     },
                     {
                         "name":"icap_req_clamav",
                         "value":"icap://10.0.10.20:1344/squidclamav bypass=off"
                     },
                     {
                         "name":"icap_resp_clamav",
                         "value":"icap://10.0.10.20:1344/squidclamav bypass=off"
                     },
                     {
                         "name":"redirect_base",
                         "value":"http://catchall-httpd.default.svc.cluster.local"
                     },
                     {
                         "name":"append_domain",
                         "value":".schultschik.nowhere"
                     },
                     {
                         "name":"xxxxdns_nameservers",
                         "value":"bhdns.default.svc.cluster.local"
                     },
                     {
                         "name":"disk_cache_size",
                         "value":"500"
                     },
                     {
                         "name":"sslbump",
                         "value":"1"
                     }
                  ],
                  "ports":[
                     {
                        "name":"proxy",
                        "containerPort":3128
                     },
                     {
                        "name":"proxy2",
                        "containerPort":3127
                     }
                  ],
                  "volumeMounts": [
                     {
                        "mountPath":"/var/spool/squid/cache",
                        "name":"sqdisk-cache"
                     },
                     {
                        "mountPath":"/var/lib/squidGuard/conf.d",
                        "name":"sqdisk-guard"
                     },
                     {
                        "mountPath":"/var/spool/squid/ssl",
                        "name":"sqdisk-ssl"
                     }
                  ],
                  "livenessProbe": {
                     "exec": {
                        "command": [
                           "/bin/sh",	
                           "/liveness_check_sg.sh"
                        ]
                     },
                     "initialDelaySeconds": 30,
                     "timeoutSeconds": 2
                  } 
               }
            ],
            "volumes":[
               {
                 "name":"sqdisk-cache",
                 "persistentVolumeClaim": {
                    "claimName":"squid-disk-claim-cache"
                 }
               },
               {
                 "name":"sqdisk-guard",
                 "persistentVolumeClaim": {
                    "claimName":"squid-guard-claim"
                 }
               },
               {
                 "name":"sqdisk-ssl",
                 "persistentVolumeClaim": {
                    "claimName":"squid-disk-claim-ssl"
                 }
               }
            ]
         }
      }
   }
}
